<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Performance hint for Imgur -->
  <link rel="preconnect" href="https://i.imgur.com">
  <link rel="dns-prefetch" href="https://i.imgur.com">

  <style>
    body { scroll-behavior:smooth; }
    .fade { animation: fadeUp .7s ease forwards; }
    @keyframes fadeUp { from{opacity:0; transform:translateY(16px)} to{opacity:1; transform:translateY(0)} }

    .input{
      width:100%;
      padding:12px 14px;
      border-radius:14px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      color:#111;
      outline:none;
    }
    .input:focus{
      border-color: rgba(0,0,0,.35);
      box-shadow: 0 0 0 4px rgba(0,0,0,.06);
    }

    .btn{ transition: transform .15s ease, opacity .15s ease; }
    .btn:hover{ transform: translateY(-1px); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; transform:none; }

    .muted{ color: rgba(0,0,0,.55); }

    .imgbox{ overflow:hidden; border-radius: 26px; background:#e9e9e9; }
    .imgbox img{ width:100%; height:100%; object-fit:cover; transform:scale(1); transition:transform .35s ease; display:block; }
    .imgbox:hover img{ transform:scale(1.035); }

    .ratio-4x3{ aspect-ratio: 4 / 3; width:100%; }
    .catalogCard{ border-radius:22px; overflow:hidden; background:#fff; border:1px solid rgba(0,0,0,.10); }

    .skeleton{
      background: linear-gradient(90deg, rgba(0,0,0,.06) 25%, rgba(0,0,0,.10) 37%, rgba(0,0,0,.06) 63%);
      background-size: 400% 100%;
      animation: shimmer 1.2s ease infinite;
    }
    @keyframes shimmer{
      0%{background-position: 100% 0}
      100%{background-position: 0 0}
    }

    .toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 60;
      max-width: 420px;
    }
  </style>
</head>

<body class="bg-[#f3f3f3] text-black">

  <!-- HEADER -->
  <header class="sticky top-0 z-40 bg-white/85 backdrop-blur border-b border-black/10">
    <div class="max-w-6xl mx-auto px-5 py-4 flex items-center justify-between">
      <div class="font-black tracking-wide text-lg">SCARCI WEAR.D</div>
      <a class="text-sm muted hover:text-black" href="https://www.instagram.com/scarciwear.d?igsh=MWt4Y2xqZnBzNGZ3dA==" target="_blank">Instagram</a>
    </div>
  </header>

  <!-- HERO -->
  <section class="max-w-6xl mx-auto px-5 pt-7 fade">
    <div class="rounded-[34px] bg-white border border-black/10 overflow-hidden">
      <div class="grid lg:grid-cols-2 gap-0 items-stretch">
        <div class="p-8 md:p-10 flex flex-col justify-center">
          <div class="text-5xl md:text-6xl font-black leading-[0.95]">
            SCARCI<br>JACKET
          </div>
          <p class="mt-4 muted max-w-md">
            Pre-Order resmi. Isi form, upload bukti transfer (JPG/PNG),
            lalu setelah berhasil, konfirmasi ke WhatsApp admin dari pop up.
          </p>
        </div>

        <div class="min-h-[360px] lg:min-h-[520px]">
          <div class="imgbox h-full rounded-none skeleton" id="heroWrap">
            <img id="heroImg" alt="Hero" decoding="async" fetchpriority="high" />
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SPLIT -->
  <section class="max-w-6xl mx-auto px-5 pt-6 fade">
    <div class="grid md:grid-cols-2 gap-5">
      <div class="rounded-[30px] bg-white border border-black/10 overflow-hidden">
        <div class="imgbox h-[330px] md:h-[420px] rounded-none skeleton" id="splitLeftWrap">
          <img id="splitLeft" alt="Split Left" loading="lazy" decoding="async" />
        </div>
      </div>
      <div class="rounded-[30px] bg-white border border-black/10 overflow-hidden">
        <div class="imgbox h-[330px] md:h-[420px] rounded-none skeleton" id="splitRightWrap">
          <img id="splitRight" alt="Split Right" loading="lazy" decoding="async" />
        </div>
      </div>
    </div>
  </section>

  <!-- FORM PO -->
  <section id="po" class="max-w-6xl mx-auto px-5 py-10 fade">
    <div class="rounded-[34px] bg-white border border-black/10 p-6 md:p-8">
      <div>
        <div class="text-2xl md:text-3xl font-black">Form Pemesanan (PO)</div>
        <div class="muted text-sm mt-1">
          Wajib upload bukti transfer (JPG/PNG) sebelum tombol “Pesan PO” aktif.
        </div>
      </div>

      <div class="mt-7 grid lg:grid-cols-2 gap-8">

        <!-- LEFT -->
        <div class="space-y-4">
          <input id="nama" class="input" placeholder="Nama lengkap *" autocomplete="name">

          <div class="grid sm:grid-cols-2 gap-3">
            <input id="wa" class="input" placeholder="No WhatsApp * (08xxxx)" inputmode="numeric" autocomplete="tel">
            <input id="email" class="input" placeholder="Email *" inputmode="email" autocomplete="email">
          </div>

          <!-- Shipping -->
          <div class="p-4 rounded-2xl border border-black/10 bg-[#fafafa]">
            <div class="font-bold">Alamat Pengiriman</div>
            <div class="mt-3 flex flex-wrap gap-4 text-sm">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="shipType" value="PPA" checked>
                <span>PPA site BIB (Free ongkir)</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="shipType" value="RUMAH">
                <span>Ke rumah</span>
              </label>
            </div>
            <textarea id="alamatRumah" class="input hidden mt-3" placeholder="Alamat rumah lengkap (muncul jika pilih 'Ke rumah')"></textarea>
          </div>

          <div class="grid sm:grid-cols-2 gap-3">
            <select id="size" class="input">
              <option value="">Pilih Size *</option>
              <option>S</option><option>M</option><option>L</option>
              <option>XL</option><option>XXL</option><option>XXXL</option>
            </select>

            <select id="warna" class="input">
              <option value="">Pilih Warna *</option>
              <option>Hitam</option>
            </select>
          </div>

          <div class="grid sm:grid-cols-2 gap-3">
            <input id="qty" type="number" min="1" value="1" class="input" placeholder="Qty *">
            <div class="p-4 rounded-2xl border border-black/10 bg-[#fafafa]">
              <div class="text-xs muted">Transfer ke</div>
              <div class="font-black text-lg leading-tight">108095453129</div>
              <div class="text-sm muted">Bank JAGO</div>
            </div>
          </div>

          <!-- Bordir -->
          <div class="p-4 rounded-2xl border border-black/10 bg-[#fafafa]">
            <div class="font-bold">Request Bordir</div>
            <div class="mt-3 flex gap-4 text-sm">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="bordirType" value="NAMA" checked>
                <span>Tulisan Nama</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="bordirType" value="LOGO">
                <span>Logo (Link)</span>
              </label>
            </div>
            <input id="bordirNama" class="input mt-3" placeholder="Tulis nama (contoh: RAN)">
            <input id="logoLink" class="input mt-3 hidden" placeholder="Tempel link logo (Google Drive/URL)">
            <div class="text-xs muted mt-2">Jika pilih Logo, pastikan link bisa dibuka.</div>
          </div>

          <!-- UPLOAD BUKTI TF -->
          <div class="p-4 rounded-2xl border border-black/10 bg-[#fafafa]">
            <div class="font-bold">Upload Bukti Transfer (Wajib)</div>
            <input id="proofFile" type="file" accept="image/jpeg,image/png" class="mt-3 w-full text-sm" />
            <div class="mt-2 text-xs muted">Format: JPG/PNG. Max 5MB.</div>
            <div id="proofHint" class="mt-2 text-xs muted"></div>

            <div id="proofPreviewWrap" class="mt-4 hidden">
              <div class="text-xs muted mb-2">Preview:</div>
              <div class="rounded-2xl overflow-hidden border border-black/10 bg-white">
                <img id="proofPreview" alt="Preview Bukti Transfer" class="w-full h-auto block" />
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT -->
        <div class="rounded-[26px] border border-black/10 bg-[#fafafa] p-6">
          <div class="flex items-center justify-between">
            <div class="font-black text-lg">Ringkasan</div>
            <div class="text-xs px-3 py-1 rounded-full border border-black/10 bg-white" id="badge">READY</div>
          </div>

          <div class="mt-4 space-y-2 text-sm">
            <div class="flex justify-between"><span class="muted">Qty</span><span id="qtyView">1</span></div>
            <div class="pt-3 border-t border-black/10 flex justify-between font-black">
              <span>Total</span><span id="totalView">Rp 299.000</span>
            </div>
          </div>

          <button id="btnSubmit" class="mt-5 w-full px-4 py-3 rounded-full bg-black text-white font-semibold btn" disabled>
            Pesan PO
          </button>

          <div id="msg" class="mt-3 text-sm muted"></div>

          <div class="mt-6 text-xs muted leading-relaxed">
            Info harga, close PO, dan estimasi pengiriman hanya muncul saat PO berhasil (pop up).
          </div>

          <div class="mt-4 text-xs muted">
            Tombol WhatsApp akan mengarah ke: <b>082154051033</b>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- CATALOG -->
  <section id="catalog" class="max-w-6xl mx-auto px-5 pb-14 fade">
    <div class="text-2xl font-black">Katalog</div>
    <div id="catalogTop" class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4"></div>

    <div class="mt-4 grid md:grid-cols-3 gap-4">
      <div id="catalogBig" class="md:col-span-2"></div>
      <div class="grid gap-4">
        <div id="catalogSmall1"></div>
        <div id="catalogSmall2"></div>
      </div>
    </div>
  </section>

  <!-- MODAL -->
  <div id="modal" class="fixed inset-0 hidden items-center justify-center z-50">
    <div class="absolute inset-0 bg-black/60"></div>
    <div class="relative w-[92%] max-w-lg rounded-[28px] bg-white border border-black/10 p-6">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="text-sm muted">PO berhasil dibuat</div>
          <div class="text-2xl font-black mt-1" id="modalOrder">ORDER ID</div>
          <div class="mt-3 text-sm">
            <div><span class="muted">Harga:</span> <b id="modalPrice">Rp 299.000</b></div>
            <div class="mt-1"><span class="muted">Close PO:</span> <b id="modalClosePo">28 Desember 2025</b></div>
            <div class="mt-1"><span class="muted">Estimasi kirim:</span> <b id="modalEstimasi">±25 hari kerja setelah close PO</b></div>
            <div class="mt-2"><span class="muted">Link bukti (Drive):</span> <a id="modalProof" href="#" target="_blank" class="underline font-semibold">Lihat</a></div>
          </div>
        </div>
        <button id="modalClose" class="px-4 py-2 rounded-full border border-black/15 bg-white text-black btn">Tutup</button>
      </div>

      <a id="modalWA" href="#" target="_blank"
         class="mt-5 block w-full text-center px-4 py-3 rounded-full bg-black text-white font-semibold btn">
        Konfirmasi ke WhatsApp
      </a>

      <div class="mt-4 text-xs muted">
        Setelah klik WhatsApp, pesan otomatis sudah berisi Order ID, nominal, dan link bukti transfer.
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="toast hidden">
    <div class="rounded-2xl border border-black/10 bg-white shadow-lg p-4 text-sm">
      <div class="font-bold" id="toastTitle">Info</div>
      <div class="muted mt-1" id="toastMsg">...</div>
    </div>
  </div>

  <script>
    // ===================== STATIC WEB MODE =====================
    // Data tetap masuk Google Sheet lewat Apps Script Web App (API).
    const API_URL = "https://script.google.com/macros/s/AKfycbxLzhneSMtYC3aPe0hsVdsBmcIgvPEr4piJgsdWn9bJ62zOenqRIAWP4PLUYG6lKf1SiA/exec";

    // ===================== LINK GAMBAR =====================
    const IMAGES = {
      HERO_IMAGE: "https://i.imgur.com/quL5Qcw.jpeg",
      SPLIT_LEFT: "https://i.imgur.com/7FQ1NIV.jpeg",
      SPLIT_RIGHT: "https://i.imgur.com/Edgg1WA.jpeg",
      CATALOG_7: [
        "https://i.imgur.com/J4QOIJB.jpeg",
        "https://i.imgur.com/4PNG2uE.jpeg",
        "https://i.imgur.com/B8BF54b.jpeg",
        "https://i.imgur.com/2KsQKvU.jpeg",
        "https://i.imgur.com/1mkKjUa.jpeg",
        "https://i.imgur.com/7AZqR4i.jpeg",
        "https://i.imgur.com/B9u6OsV.png"
      ]
    };

    const PRICE = 299000;
    const MAX_FILE_MB = 5;

    function rupiah(n){
      return 'Rp ' + (Math.round(n)).toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }
    function toast(title, message){
      const t = document.getElementById('toast');
      document.getElementById('toastTitle').textContent = title || 'Info';
      document.getElementById('toastMsg').textContent = message || '';
      t.classList.remove('hidden');
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(() => t.classList.add('hidden'), 3200);
    }
    function setImg(idImg, idWrap, url){
      const img = document.getElementById(idImg);
      const wrap = document.getElementById(idWrap);
      if (!img || !wrap) return;
      img.onload = () => wrap.classList.remove('skeleton');
      img.onerror = () => {
        wrap.classList.remove('skeleton');
        wrap.style.background = '#ddd';
      };
      img.src = url || '';
    }
    function makeCatalogCard(url){
      const wrap = document.createElement('div');
      wrap.className = "catalogCard";
      const inner = document.createElement('div');
      inner.className = "ratio-4x3 skeleton";
      const img = document.createElement('img');
      img.alt = "catalog";
      img.loading = "lazy";
      img.decoding = "async";
      img.style.width = "100%";
      img.style.height = "100%";
      img.style.objectFit = "cover";
      img.style.display = "block";
      img.onload = () => inner.classList.remove('skeleton');
      img.onerror = () => inner.classList.remove('skeleton');
      img.src = url;
      inner.appendChild(img);
      wrap.appendChild(inner);
      return wrap;
    }
    function getVal(id){ return (document.getElementById(id).value || '').trim(); }
    function normalizeWA(input){
      return String(input || '').replace(/\s+/g,'').replace(/[^0-9+]/g,'');
    }
    function validateEmail(email){
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(email || '').trim());
    }
    function fileToBase64(file){
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(String(reader.result).split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
    async function submitToApi(data){
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type":"text/plain;charset=utf-8" },
        body: JSON.stringify(data)
      });
      const json = await res.json();
      if (!json.ok) throw new Error(json.message || "Gagal submit.");
      return json;
    }

    window.addEventListener('DOMContentLoaded', () => {
      setImg('heroImg', 'heroWrap', IMAGES.HERO_IMAGE);
      setImg('splitLeft', 'splitLeftWrap', IMAGES.SPLIT_LEFT);
      setImg('splitRight', 'splitRightWrap', IMAGES.SPLIT_RIGHT);

      const c = (IMAGES.CATALOG_7 || []).filter(Boolean);
      const top = document.getElementById('catalogTop');
      const big = document.getElementById('catalogBig');
      const s1 = document.getElementById('catalogSmall1');
      const s2 = document.getElementById('catalogSmall2');
      if (top) c.slice(0,4).forEach(url => top.appendChild(makeCatalogCard(url)));
      if (big && c[4]) big.appendChild(makeCatalogCard(c[4]));
      if (s1 && c[5]) s1.appendChild(makeCatalogCard(c[5]));
      if (s2 && c[6]) s2.appendChild(makeCatalogCard(c[6]));

      const qtyEl = document.getElementById('qty');
      const qtyView = document.getElementById('qtyView');
      const totalView = document.getElementById('totalView');
      function refreshTotal(){
        const q = Math.max(1, Number(qtyEl.value || 1));
        qtyView.textContent = q;
        totalView.textContent = rupiah(PRICE * q);
      }
      qtyEl.addEventListener('input', refreshTotal);
      refreshTotal();

      const alamatRumah = document.getElementById('alamatRumah');
      document.querySelectorAll('input[name="shipType"]').forEach(r => {
        r.addEventListener('change', () => {
          const v = document.querySelector('input[name="shipType"]:checked').value;
          alamatRumah.classList.toggle('hidden', v !== 'RUMAH');
        });
      });

      const bordirNama = document.getElementById('bordirNama');
      const logoLink = document.getElementById('logoLink');
      document.querySelectorAll('input[name="bordirType"]').forEach(r => {
        r.addEventListener('change', () => {
          const v = document.querySelector('input[name="bordirType"]:checked').value;
          bordirNama.classList.toggle('hidden', v === 'LOGO');
          logoLink.classList.toggle('hidden', v === 'NAMA');
        });
      });

      const proofFile = document.getElementById('proofFile');
      const proofHint = document.getElementById('proofHint');
      const proofPreviewWrap = document.getElementById('proofPreviewWrap');
      const proofPreview = document.getElementById('proofPreview');

      const btnSubmit = document.getElementById('btnSubmit');
      const msg = document.getElementById('msg');

      function toggleSubmitByFile(){
        const f = proofFile.files && proofFile.files[0];
        btnSubmit.disabled = !f;
        proofHint.textContent = f ? `File dipilih: ${f.name}` : '';
      }

      proofFile.addEventListener('change', () => {
        toggleSubmitByFile();
        const f = proofFile.files && proofFile.files[0];
        if (!f) {
          proofPreviewWrap.classList.add('hidden');
          proofPreview.removeAttribute('src');
          return;
        }

        const typeOk = ['image/jpeg','image/png','image/jpg'].includes((f.type || '').toLowerCase());
        const sizeOk = (f.size || 0) <= (MAX_FILE_MB * 1024 * 1024);

        if (!typeOk) {
          toast("Format tidak valid", "Bukti transfer harus JPG/PNG.");
          proofPreviewWrap.classList.add('hidden');
          proofPreview.removeAttribute('src');
          btnSubmit.disabled = true;
          return;
        }
        if (!sizeOk) {
          toast("File terlalu besar", `Max ${MAX_FILE_MB}MB. Kompres dulu ya.`);
          proofPreviewWrap.classList.add('hidden');
          proofPreview.removeAttribute('src');
          btnSubmit.disabled = true;
          return;
        }

        const url = URL.createObjectURL(f);
        proofPreview.src = url;
        proofPreviewWrap.classList.remove('hidden');
      });

      toggleSubmitByFile();

      const modal = document.getElementById('modal');
      const modalOrder = document.getElementById('modalOrder');
      const modalWA = document.getElementById('modalWA');
      const modalClose = document.getElementById('modalClose');
      const modalPrice = document.getElementById('modalPrice');
      const modalClosePo = document.getElementById('modalClosePo');
      const modalEstimasi = document.getElementById('modalEstimasi');
      const modalProof = document.getElementById('modalProof');

      function openModal(){
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
      function closeModal(){
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      }
      modalClose.addEventListener('click', closeModal);

      function lockBtn(text){
        btnSubmit.disabled = true;
        btnSubmit.textContent = text || 'Memproses...';
      }
      function unlockBtn(){
        const f = proofFile.files && proofFile.files[0];
        btnSubmit.disabled = !f;
        btnSubmit.textContent = 'Pesan PO';
      }

      btnSubmit.addEventListener('click', async () => {
        msg.textContent = '';

        const nama = getVal('nama');
        const wa = normalizeWA(getVal('wa'));
        const email = getVal('email');
        const size = getVal('size');
        const warna = getVal('warna');
        const qty = getVal('qty');

        if (!nama || !wa || !email || !size || !warna || !qty) {
          msg.textContent = 'Mohon lengkapi data wajib.';
          toast("Form belum lengkap", "Lengkapi field bertanda *.");
          return;
        }
        if (!validateEmail(email)) {
          msg.textContent = 'Email tidak valid.';
          toast("Email tidak valid", "Periksa kembali email kamu.");
          return;
        }

        const shipType = document.querySelector('input[name="shipType"]:checked').value;
        const alamat = shipType === 'PPA' ? 'PPA site BIB (Free ongkir)' : getVal('alamatRumah');
        if (shipType === 'RUMAH' && !alamat) {
          msg.textContent = 'Alamat rumah wajib diisi.';
          toast("Alamat belum diisi", "Isi alamat lengkap untuk pengiriman ke rumah.");
          return;
        }

        const bordirType = document.querySelector('input[name="bordirType"]:checked').value;
        const bordirNamaVal = getVal('bordirNama');
        const logoLinkVal = getVal('logoLink');
        if (bordirType === 'NAMA' && !bordirNamaVal) {
          msg.textContent = 'Tulisan nama bordir wajib diisi.';
          toast("Bordir belum diisi", "Isi tulisan nama bordir.");
          return;
        }
        if (bordirType === 'LOGO' && !logoLinkVal) {
          msg.textContent = 'Link logo wajib diisi jika memilih Logo.';
          toast("Link logo kosong", "Tempel link logo yang bisa dibuka.");
          return;
        }

        const f = proofFile.files && proofFile.files[0];
        if (!f) {
          msg.textContent = 'Bukti transfer wajib diupload.';
          toast("Upload bukti dulu", "Pilih file JPG/PNG.");
          return;
        }

        const typeOk = ['image/jpeg','image/png','image/jpg'].includes((f.type || '').toLowerCase());
        if (!typeOk) {
          msg.textContent = 'Format bukti transfer harus JPG atau PNG.';
          toast("Format tidak valid", "Bukti transfer harus JPG/PNG.");
          return;
        }

        let base64;
        try {
          lockBtn('Mengupload...');
          base64 = await fileToBase64(f);
        } catch (e) {
          msg.textContent = 'Gagal membaca file bukti transfer.';
          toast("Gagal membaca file", "Coba pilih ulang file bukti transfer.");
          unlockBtn();
          return;
        }

        lockBtn('Memproses...');
        const payload = {
          nama, wa, email, alamat, size, warna, qty,
          bordir_nama: (bordirType === 'NAMA') ? bordirNamaVal : 'LOGO',
          logo_url: (bordirType === 'LOGO') ? logoLinkVal : '',
          proof_file: { fileName: f.name, mimeType: f.type, base64 }
        };

        try {
          const res = await submitToApi(payload);

          msg.innerHTML = `Berhasil! Order ID: <b>${res.orderId}</b>`;
          modalOrder.textContent = res.orderId;

          modalPrice.textContent = rupiah(res.price || PRICE);
          modalClosePo.textContent = res.closePoDate || '28 Desember 2025';
          modalEstimasi.textContent = res.estimasiKirim || '±25 hari kerja setelah close PO (28 Desember 2025)';
          modalProof.href = res.proofUrl || '#';
          modalWA.href = res.waLink || `https://wa.me/6282154051033`;

          openModal();
          toast("PO berhasil", "Silakan lanjut konfirmasi ke WhatsApp dari pop up.");
          unlockBtn();
        } catch (err) {
          msg.innerHTML = `<span style="color:#b91c1c;font-weight:700">Gagal:</span> ${err.message || err}`;
          toast("Gagal submit", err.message || String(err));
          unlockBtn();
        }
      });
    });
  </script>
</body>
</html>
